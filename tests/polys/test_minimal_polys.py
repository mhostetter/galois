"""
A pytest module to test generating minimal polynomials.

Sage:
    p = 2
    for degree in range(1, 5):
        F.<x> = GF(p**degree, repr="int")
        print(f"MINIMAL_POLYS_{p}_{degree} = {{")
        for e in range(0, F.order()):
            e = F(e) if degree == 1 else F.fetch_int(e)
            c = e.minpoly().coefficients(sparse=False)[::-1]
            print(f"    {e}: galois.Poly({c}, field=GF{p}),",)
        print("}\n")
"""
import pytest
import numpy as np

import galois

GF2 = galois.GF(2)
GF3 = galois.GF(3)
GF5 = galois.GF(5)

MINIMAL_POLYS_2_1 = {
    0: galois.Poly([1, 0], field=GF2),
    1: galois.Poly([1, 1], field=GF2),
}

MINIMAL_POLYS_2_2 = {
    0: galois.Poly([1, 0], field=GF2),
    1: galois.Poly([1, 1], field=GF2),
    2: galois.Poly([1, 1, 1], field=GF2),
    3: galois.Poly([1, 1, 1], field=GF2),
}

MINIMAL_POLYS_2_3 = {
    0: galois.Poly([1, 0], field=GF2),
    1: galois.Poly([1, 1], field=GF2),
    2: galois.Poly([1, 0, 1, 1], field=GF2),
    3: galois.Poly([1, 1, 0, 1], field=GF2),
    4: galois.Poly([1, 0, 1, 1], field=GF2),
    5: galois.Poly([1, 1, 0, 1], field=GF2),
    6: galois.Poly([1, 0, 1, 1], field=GF2),
    7: galois.Poly([1, 1, 0, 1], field=GF2),
}

MINIMAL_POLYS_2_4 = {
    0: galois.Poly([1, 0], field=GF2),
    1: galois.Poly([1, 1], field=GF2),
    2: galois.Poly([1, 0, 0, 1, 1], field=GF2),
    3: galois.Poly([1, 0, 0, 1, 1], field=GF2),
    4: galois.Poly([1, 0, 0, 1, 1], field=GF2),
    5: galois.Poly([1, 0, 0, 1, 1], field=GF2),
    6: galois.Poly([1, 1, 1], field=GF2),
    7: galois.Poly([1, 1, 1], field=GF2),
    8: galois.Poly([1, 1, 1, 1, 1], field=GF2),
    9: galois.Poly([1, 1, 0, 0, 1], field=GF2),
    10: galois.Poly([1, 1, 1, 1, 1], field=GF2),
    11: galois.Poly([1, 1, 0, 0, 1], field=GF2),
    12: galois.Poly([1, 1, 1, 1, 1], field=GF2),
    13: galois.Poly([1, 1, 0, 0, 1], field=GF2),
    14: galois.Poly([1, 1, 0, 0, 1], field=GF2),
    15: galois.Poly([1, 1, 1, 1, 1], field=GF2),
}

MINIMAL_POLYS_3_1 = {
    0: galois.Poly([1, 0], field=GF3),
    1: galois.Poly([1, 2], field=GF3),
    2: galois.Poly([1, 1], field=GF3),
}

MINIMAL_POLYS_3_2 = {
    0: galois.Poly([1, 0], field=GF3),
    1: galois.Poly([1, 2], field=GF3),
    2: galois.Poly([1, 1], field=GF3),
    3: galois.Poly([1, 2, 2], field=GF3),
    4: galois.Poly([1, 0, 1], field=GF3),
    5: galois.Poly([1, 1, 2], field=GF3),
    6: galois.Poly([1, 1, 2], field=GF3),
    7: galois.Poly([1, 2, 2], field=GF3),
    8: galois.Poly([1, 0, 1], field=GF3),
}

MINIMAL_POLYS_3_3 = {
    0: galois.Poly([1, 0], field=GF3),
    1: galois.Poly([1, 2], field=GF3),
    2: galois.Poly([1, 1], field=GF3),
    3: galois.Poly([1, 0, 2, 1], field=GF3),
    4: galois.Poly([1, 0, 2, 1], field=GF3),
    5: galois.Poly([1, 0, 2, 1], field=GF3),
    6: galois.Poly([1, 0, 2, 2], field=GF3),
    7: galois.Poly([1, 0, 2, 2], field=GF3),
    8: galois.Poly([1, 0, 2, 2], field=GF3),
    9: galois.Poly([1, 1, 1, 2], field=GF3),
    10: galois.Poly([1, 1, 2, 1], field=GF3),
    11: galois.Poly([1, 1, 0, 2], field=GF3),
    12: galois.Poly([1, 1, 0, 2], field=GF3),
    13: galois.Poly([1, 1, 1, 2], field=GF3),
    14: galois.Poly([1, 1, 2, 1], field=GF3),
    15: galois.Poly([1, 1, 0, 2], field=GF3),
    16: galois.Poly([1, 1, 1, 2], field=GF3),
    17: galois.Poly([1, 1, 2, 1], field=GF3),
    18: galois.Poly([1, 2, 1, 1], field=GF3),
    19: galois.Poly([1, 2, 0, 1], field=GF3),
    20: galois.Poly([1, 2, 2, 2], field=GF3),
    21: galois.Poly([1, 2, 0, 1], field=GF3),
    22: galois.Poly([1, 2, 2, 2], field=GF3),
    23: galois.Poly([1, 2, 1, 1], field=GF3),
    24: galois.Poly([1, 2, 0, 1], field=GF3),
    25: galois.Poly([1, 2, 2, 2], field=GF3),
    26: galois.Poly([1, 2, 1, 1], field=GF3),
}

MINIMAL_POLYS_3_4 = {
    0: galois.Poly([1, 0], field=GF3),
    1: galois.Poly([1, 2], field=GF3),
    2: galois.Poly([1, 1], field=GF3),
    3: galois.Poly([1, 2, 0, 0, 2], field=GF3),
    4: galois.Poly([1, 1, 0, 2, 1], field=GF3),
    5: galois.Poly([1, 0, 0, 1, 2], field=GF3),
    6: galois.Poly([1, 1, 0, 0, 2], field=GF3),
    7: galois.Poly([1, 0, 0, 2, 2], field=GF3),
    8: galois.Poly([1, 2, 0, 1, 1], field=GF3),
    9: galois.Poly([1, 2, 1, 0, 1], field=GF3),
    10: galois.Poly([1, 1, 1, 0, 1], field=GF3),
    11: galois.Poly([1, 0, 1, 0, 2], field=GF3),
    12: galois.Poly([1, 1, 1, 2, 2], field=GF3),
    13: galois.Poly([1, 0, 1, 2, 1], field=GF3),
    14: galois.Poly([1, 2, 1, 2, 1], field=GF3),
    15: galois.Poly([1, 0, 1, 2, 1], field=GF3),
    16: galois.Poly([1, 2, 1, 2, 1], field=GF3),
    17: galois.Poly([1, 1, 1, 2, 2], field=GF3),
    18: galois.Poly([1, 1, 1, 0, 1], field=GF3),
    19: galois.Poly([1, 0, 1, 0, 2], field=GF3),
    20: galois.Poly([1, 2, 1, 0, 1], field=GF3),
    21: galois.Poly([1, 0, 1, 1, 1], field=GF3),
    22: galois.Poly([1, 2, 1, 1, 2], field=GF3),
    23: galois.Poly([1, 1, 1, 1, 1], field=GF3),
    24: galois.Poly([1, 2, 1, 1, 2], field=GF3),
    25: galois.Poly([1, 1, 1, 1, 1], field=GF3),
    26: galois.Poly([1, 0, 1, 1, 1], field=GF3),
    27: galois.Poly([1, 2, 0, 0, 2], field=GF3),
    28: galois.Poly([1, 1, 0, 2, 1], field=GF3),
    29: galois.Poly([1, 0, 0, 1, 2], field=GF3),
    30: galois.Poly([1, 1, 2, 2, 2], field=GF3),
    31: galois.Poly([1, 0, 2, 0, 2], field=GF3),
    32: galois.Poly([1, 2, 2, 1, 2], field=GF3),
    33: galois.Poly([1, 0, 1, 2, 1], field=GF3),
    34: galois.Poly([1, 2, 1, 2, 1], field=GF3),
    35: galois.Poly([1, 1, 1, 2, 2], field=GF3),
    36: galois.Poly([1, 2, 2], field=GF3),
    37: galois.Poly([1, 0, 1], field=GF3),
    38: galois.Poly([1, 1, 2], field=GF3),
    39: galois.Poly([1, 0, 1, 0, 2], field=GF3),
    40: galois.Poly([1, 2, 1, 0, 1], field=GF3),
    41: galois.Poly([1, 1, 1, 0, 1], field=GF3),
    42: galois.Poly([1, 2, 0, 0, 2], field=GF3),
    43: galois.Poly([1, 1, 0, 2, 1], field=GF3),
    44: galois.Poly([1, 0, 0, 1, 2], field=GF3),
    45: galois.Poly([1, 0, 0, 1, 2], field=GF3),
    46: galois.Poly([1, 2, 0, 0, 2], field=GF3),
    47: galois.Poly([1, 1, 0, 2, 1], field=GF3),
    48: galois.Poly([1, 2, 2, 1, 2], field=GF3),
    49: galois.Poly([1, 1, 2, 2, 2], field=GF3),
    50: galois.Poly([1, 0, 2, 0, 2], field=GF3),
    51: galois.Poly([1, 1, 1, 1, 1], field=GF3),
    52: galois.Poly([1, 0, 1, 1, 1], field=GF3),
    53: galois.Poly([1, 2, 1, 1, 2], field=GF3),
    54: galois.Poly([1, 1, 0, 0, 2], field=GF3),
    55: galois.Poly([1, 0, 0, 2, 2], field=GF3),
    56: galois.Poly([1, 2, 0, 1, 1], field=GF3),
    57: galois.Poly([1, 0, 1, 1, 1], field=GF3),
    58: galois.Poly([1, 2, 1, 1, 2], field=GF3),
    59: galois.Poly([1, 1, 1, 1, 1], field=GF3),
    60: galois.Poly([1, 2, 2, 1, 2], field=GF3),
    61: galois.Poly([1, 1, 2, 2, 2], field=GF3),
    62: galois.Poly([1, 0, 2, 0, 2], field=GF3),
    63: galois.Poly([1, 0, 0, 2, 2], field=GF3),
    64: galois.Poly([1, 2, 0, 1, 1], field=GF3),
    65: galois.Poly([1, 1, 0, 0, 2], field=GF3),
    66: galois.Poly([1, 2, 1, 2, 1], field=GF3),
    67: galois.Poly([1, 1, 1, 2, 2], field=GF3),
    68: galois.Poly([1, 0, 1, 2, 1], field=GF3),
    69: galois.Poly([1, 1, 2, 2, 2], field=GF3),
    70: galois.Poly([1, 0, 2, 0, 2], field=GF3),
    71: galois.Poly([1, 2, 2, 1, 2], field=GF3),
    72: galois.Poly([1, 1, 2], field=GF3),
    73: galois.Poly([1, 2, 2], field=GF3),
    74: galois.Poly([1, 0, 1], field=GF3),
    75: galois.Poly([1, 1, 0, 0, 2], field=GF3),
    76: galois.Poly([1, 0, 0, 2, 2], field=GF3),
    77: galois.Poly([1, 2, 0, 1, 1], field=GF3),
    78: galois.Poly([1, 0, 1, 0, 2], field=GF3),
    79: galois.Poly([1, 2, 1, 0, 1], field=GF3),
    80: galois.Poly([1, 1, 1, 0, 1], field=GF3),
}

MINIMAL_POLYS_5_1 = {
    0: galois.Poly([1, 0], field=GF5),
    1: galois.Poly([1, 4], field=GF5),
    2: galois.Poly([1, 3], field=GF5),
    3: galois.Poly([1, 2], field=GF5),
    4: galois.Poly([1, 1], field=GF5),
}

MINIMAL_POLYS_5_2 = {
    0: galois.Poly([1, 0], field=GF5),
    1: galois.Poly([1, 4], field=GF5),
    2: galois.Poly([1, 3], field=GF5),
    3: galois.Poly([1, 2], field=GF5),
    4: galois.Poly([1, 1], field=GF5),
    5: galois.Poly([1, 4, 2], field=GF5),
    6: galois.Poly([1, 2, 4], field=GF5),
    7: galois.Poly([1, 0, 3], field=GF5),
    8: galois.Poly([1, 3, 4], field=GF5),
    9: galois.Poly([1, 1, 2], field=GF5),
    10: galois.Poly([1, 3, 3], field=GF5),
    11: galois.Poly([1, 1, 1], field=GF5),
    12: galois.Poly([1, 4, 1], field=GF5),
    13: galois.Poly([1, 2, 3], field=GF5),
    14: galois.Poly([1, 0, 2], field=GF5),
    15: galois.Poly([1, 2, 3], field=GF5),
    16: galois.Poly([1, 0, 2], field=GF5),
    17: galois.Poly([1, 3, 3], field=GF5),
    18: galois.Poly([1, 1, 1], field=GF5),
    19: galois.Poly([1, 4, 1], field=GF5),
    20: galois.Poly([1, 1, 2], field=GF5),
    21: galois.Poly([1, 4, 2], field=GF5),
    22: galois.Poly([1, 2, 4], field=GF5),
    23: galois.Poly([1, 0, 3], field=GF5),
    24: galois.Poly([1, 3, 4], field=GF5),
}

MINIMAL_POLYS_5_3 = {
    0: galois.Poly([1, 0], field=GF5),
    1: galois.Poly([1, 4], field=GF5),
    2: galois.Poly([1, 3], field=GF5),
    3: galois.Poly([1, 2], field=GF5),
    4: galois.Poly([1, 1], field=GF5),
    5: galois.Poly([1, 0, 3, 3], field=GF5),
    6: galois.Poly([1, 2, 1, 4], field=GF5),
    7: galois.Poly([1, 4, 0, 4], field=GF5),
    8: galois.Poly([1, 1, 0, 2], field=GF5),
    9: galois.Poly([1, 3, 1, 2], field=GF5),
    10: galois.Poly([1, 0, 2, 4], field=GF5),
    11: galois.Poly([1, 2, 0, 1], field=GF5),
    12: galois.Poly([1, 4, 4, 2], field=GF5),
    13: galois.Poly([1, 1, 4, 1], field=GF5),
    14: galois.Poly([1, 3, 0, 2], field=GF5),
    15: galois.Poly([1, 0, 2, 1], field=GF5),
    16: galois.Poly([1, 2, 0, 3], field=GF5),
    17: galois.Poly([1, 4, 4, 4], field=GF5),
    18: galois.Poly([1, 1, 4, 3], field=GF5),
    19: galois.Poly([1, 3, 0, 4], field=GF5),
    20: galois.Poly([1, 0, 3, 2], field=GF5),
    21: galois.Poly([1, 2, 1, 3], field=GF5),
    22: galois.Poly([1, 4, 0, 3], field=GF5),
    23: galois.Poly([1, 1, 0, 1], field=GF5),
    24: galois.Poly([1, 3, 1, 1], field=GF5),
    25: galois.Poly([1, 1, 4, 1], field=GF5),
    26: galois.Poly([1, 3, 0, 2], field=GF5),
    27: galois.Poly([1, 0, 2, 4], field=GF5),
    28: galois.Poly([1, 2, 0, 1], field=GF5),
    29: galois.Poly([1, 4, 4, 2], field=GF5),
    30: galois.Poly([1, 1, 1, 3], field=GF5),
    31: galois.Poly([1, 3, 2, 2], field=GF5),
    32: galois.Poly([1, 0, 4, 2], field=GF5),
    33: galois.Poly([1, 2, 2, 2], field=GF5),
    34: galois.Poly([1, 4, 1, 1], field=GF5),
    35: galois.Poly([1, 1, 4, 3], field=GF5),
    36: galois.Poly([1, 3, 0, 4], field=GF5),
    37: galois.Poly([1, 0, 2, 1], field=GF5),
    38: galois.Poly([1, 2, 0, 3], field=GF5),
    39: galois.Poly([1, 4, 4, 4], field=GF5),
    40: galois.Poly([1, 1, 3, 4], field=GF5),
    41: galois.Poly([1, 3, 4, 1], field=GF5),
    42: galois.Poly([1, 0, 1, 4], field=GF5),
    43: galois.Poly([1, 2, 4, 2], field=GF5),
    44: galois.Poly([1, 4, 3, 4], field=GF5),
    45: galois.Poly([1, 1, 3, 4], field=GF5),
    46: galois.Poly([1, 3, 4, 1], field=GF5),
    47: galois.Poly([1, 0, 1, 4], field=GF5),
    48: galois.Poly([1, 2, 4, 2], field=GF5),
    49: galois.Poly([1, 4, 3, 4], field=GF5),
    50: galois.Poly([1, 2, 1, 3], field=GF5),
    51: galois.Poly([1, 4, 0, 3], field=GF5),
    52: galois.Poly([1, 1, 0, 1], field=GF5),
    53: galois.Poly([1, 3, 1, 1], field=GF5),
    54: galois.Poly([1, 0, 3, 2], field=GF5),
    55: galois.Poly([1, 2, 2, 2], field=GF5),
    56: galois.Poly([1, 4, 1, 1], field=GF5),
    57: galois.Poly([1, 1, 1, 3], field=GF5),
    58: galois.Poly([1, 3, 2, 2], field=GF5),
    59: galois.Poly([1, 0, 4, 2], field=GF5),
    60: galois.Poly([1, 2, 4, 4], field=GF5),
    61: galois.Poly([1, 4, 3, 1], field=GF5),
    62: galois.Poly([1, 1, 3, 1], field=GF5),
    63: galois.Poly([1, 3, 4, 3], field=GF5),
    64: galois.Poly([1, 0, 1, 1], field=GF5),
    65: galois.Poly([1, 2, 2, 2], field=GF5),
    66: galois.Poly([1, 4, 1, 1], field=GF5),
    67: galois.Poly([1, 1, 1, 3], field=GF5),
    68: galois.Poly([1, 3, 2, 2], field=GF5),
    69: galois.Poly([1, 0, 4, 2], field=GF5),
    70: galois.Poly([1, 2, 1, 4], field=GF5),
    71: galois.Poly([1, 4, 0, 4], field=GF5),
    72: galois.Poly([1, 1, 0, 2], field=GF5),
    73: galois.Poly([1, 3, 1, 2], field=GF5),
    74: galois.Poly([1, 0, 3, 3], field=GF5),
    75: galois.Poly([1, 3, 1, 2], field=GF5),
    76: galois.Poly([1, 0, 3, 3], field=GF5),
    77: galois.Poly([1, 2, 1, 4], field=GF5),
    78: galois.Poly([1, 4, 0, 4], field=GF5),
    79: galois.Poly([1, 1, 0, 2], field=GF5),
    80: galois.Poly([1, 3, 1, 1], field=GF5),
    81: galois.Poly([1, 0, 3, 2], field=GF5),
    82: galois.Poly([1, 2, 1, 3], field=GF5),
    83: galois.Poly([1, 4, 0, 3], field=GF5),
    84: galois.Poly([1, 1, 0, 1], field=GF5),
    85: galois.Poly([1, 3, 2, 3], field=GF5),
    86: galois.Poly([1, 0, 4, 3], field=GF5),
    87: galois.Poly([1, 2, 2, 3], field=GF5),
    88: galois.Poly([1, 4, 1, 2], field=GF5),
    89: galois.Poly([1, 1, 1, 4], field=GF5),
    90: galois.Poly([1, 3, 4, 1], field=GF5),
    91: galois.Poly([1, 0, 1, 4], field=GF5),
    92: galois.Poly([1, 2, 4, 2], field=GF5),
    93: galois.Poly([1, 4, 3, 4], field=GF5),
    94: galois.Poly([1, 1, 3, 4], field=GF5),
    95: galois.Poly([1, 3, 2, 3], field=GF5),
    96: galois.Poly([1, 0, 4, 3], field=GF5),
    97: galois.Poly([1, 2, 2, 3], field=GF5),
    98: galois.Poly([1, 4, 1, 2], field=GF5),
    99: galois.Poly([1, 1, 1, 4], field=GF5),
    100: galois.Poly([1, 4, 4, 4], field=GF5),
    101: galois.Poly([1, 1, 4, 3], field=GF5),
    102: galois.Poly([1, 3, 0, 4], field=GF5),
    103: galois.Poly([1, 0, 2, 1], field=GF5),
    104: galois.Poly([1, 2, 0, 3], field=GF5),
    105: galois.Poly([1, 4, 3, 1], field=GF5),
    106: galois.Poly([1, 1, 3, 1], field=GF5),
    107: galois.Poly([1, 3, 4, 3], field=GF5),
    108: galois.Poly([1, 0, 1, 1], field=GF5),
    109: galois.Poly([1, 2, 4, 4], field=GF5),
    110: galois.Poly([1, 4, 3, 1], field=GF5),
    111: galois.Poly([1, 1, 3, 1], field=GF5),
    112: galois.Poly([1, 3, 4, 3], field=GF5),
    113: galois.Poly([1, 0, 1, 1], field=GF5),
    114: galois.Poly([1, 2, 4, 4], field=GF5),
    115: galois.Poly([1, 4, 4, 2], field=GF5),
    116: galois.Poly([1, 1, 4, 1], field=GF5),
    117: galois.Poly([1, 3, 0, 2], field=GF5),
    118: galois.Poly([1, 0, 2, 4], field=GF5),
    119: galois.Poly([1, 2, 0, 1], field=GF5),
    120: galois.Poly([1, 4, 1, 2], field=GF5),
    121: galois.Poly([1, 1, 1, 4], field=GF5),
    122: galois.Poly([1, 3, 2, 3], field=GF5),
    123: galois.Poly([1, 0, 4, 3], field=GF5),
    124: galois.Poly([1, 2, 2, 3], field=GF5),
}


def test_minimal_poly_exceptions():
    with pytest.raises(TypeError):
        galois.minimal_poly(4)
    with pytest.raises(TypeError):
        galois.minimal_poly(np.array(4))
    with pytest.raises(ValueError):
        galois.minimal_poly(GF5([4,3]))


@pytest.mark.parametrize("characteristic,degree", [(2,1), (2,2), (2,3), (2,4), (3,1), (3,2), (3,3), (3,4), (5,1), (5,2), (5,3)])
def test_minimal_poly(characteristic, degree):
    LUT = eval(f"MINIMAL_POLYS_{characteristic}_{degree}")
    for e in galois.GF(characteristic**degree).Elements():
        assert galois.minimal_poly(e) == LUT[int(e)]
