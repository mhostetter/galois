"""
A pytest module to benchmark FieldArray arithmetic.
"""

import itertools

import numpy as np
import pytest

import galois


@pytest.mark.parametrize("size_K", [1, 2, 3, 4, 5, 6, 7, 8, 9])
@pytest.mark.benchmark()
def test_fft(size_K, benchmark):
    size = size_K * 256
    for order in itertools.count(size + 1, step=size):
        p, e = galois.factors(order)
        if len(p) == len(e) == 1:
            break
    GF = galois.GF(p[0], e[0])
    x = GF.Random(size)
    benchmark(np.fft.fft, x)


"""
python3 -m pytest benchmarks/test_fft.py --benchmark-columns=mean,median --benchmark-sort=name --benchmark-save=CURRENT
rm .benchmarks/Darwin-CPython-3.13-64bit/*CURRENT*
pytest-benchmark compare *CURRENT
oo

test_fft[1] (0002_UPDATED)      40.7919 (1.0)      115.7913 (1.25)      60.9251 (1.05)     31.1854 (11.11)     48.8749 (1.0)      27.7492 (8.91)          1;1       16.4136 (0.95)          5           1
test_fft[2] (0002_UPDATED)      46.0842 (1.13)     118.5830 (1.28)      64.8169 (1.12)     30.2850 (10.79)     51.6674 (1.06)     22.1868 (7.13)          1;1       15.4281 (0.89)          5           1
test_fft[3] (0002_UPDATED)      49.1249 (1.20)     121.8333 (1.32)      68.1835 (1.18)     30.5442 (10.88)     54.8749 (1.12)     28.0517 (9.01)          1;1       14.6663 (0.85)          5           1
test_fft[6] (0002_UPDATED)      54.9592 (1.35)      92.2917 (1.0)       57.7701 (1.0)       2.8072 (1.0)       56.2500 (1.15)      3.1135 (1.0)        988;61       17.3100 (1.0)        4511           1
test_fft[4] (0002_UPDATED)      55.2088 (1.35)     140.7908 (1.53)      76.5583 (1.33)     36.3506 (12.95)     58.6254 (1.20)     30.3334 (9.74)          1;1       13.0619 (0.75)          5           1
test_fft[5] (0002_UPDATED)      55.8752 (1.37)     112.9578 (1.22)      59.6429 (1.03)      3.3985 (1.21)      59.7909 (1.22)      4.1253 (1.32)       514;56       16.7665 (0.97)       4519           1
test_fft[8] (0002_UPDATED)      61.0002 (1.50)     140.2092 (1.52)      64.0353 (1.11)      3.6990 (1.32)      62.5420 (1.28)      3.1246 (1.00)       147;46       15.6164 (0.90)       2088           1
test_fft[1] (0001_ORIGINA)      63.2918 (1.55)     128.2077 (1.39)      78.9167 (1.37)     28.0048 (9.98)      64.5830 (1.32)     25.1665 (8.08)          1;1       12.6716 (0.73)          5           1
test_fft[3] (0001_ORIGINA)      71.9167 (1.76)     127.6671 (1.38)      87.5834 (1.52)     22.8828 (8.15)      79.2500 (1.62)     20.9375 (6.72)          1;1       11.4177 (0.66)          5           1
test_fft[2] (0001_ORIGINA)      79.4581 (1.95)     140.4169 (1.52)      94.6919 (1.64)     25.7963 (9.19)      85.9592 (1.76)     20.6453 (6.63)          1;1       10.5606 (0.61)          5           1
test_fft[7] (0002_UPDATED)      92.7080 (2.27)     165.8332 (1.80)     112.2918 (1.94)     30.5772 (10.89)     97.6673 (2.00)     28.2816 (9.08)          1;0        8.9054 (0.51)          5           1
test_fft[5] (0001_ORIGINA)      94.7081 (2.32)     451.6668 (4.89)      99.9278 (1.73)      8.1888 (2.92)      98.8748 (2.02)      5.3747 (1.73)      144;124       10.0072 (0.58)       5771           1
test_fft[6] (0001_ORIGINA)     111.4998 (2.73)     682.7503 (7.40)     119.1196 (2.06)      9.7433 (3.47)     119.0840 (2.44)      4.9063 (1.58)      160;193        8.3949 (0.48)       6583           1
test_fft[4] (0001_ORIGINA)     132.7079 (3.25)     195.7910 (2.12)     148.4245 (2.57)     26.8516 (9.57)     136.6660 (2.80)     23.8020 (7.64)          1;1        6.7374 (0.39)          5           1
test_fft[7] (0001_ORIGINA)     147.2919 (3.61)     227.4578 (2.46)     166.8914 (2.89)     34.4740 (12.28)    148.6661 (3.04)     31.1978 (10.02)         1;1        5.9919 (0.35)          5           1
test_fft[9] (0002_UPDATED)     192.0001 (4.71)     260.6250 (2.82)     211.2084 (3.66)     28.1355 (10.02)    202.9580 (4.15)     24.3748 (7.83)          1;1        4.7347 (0.27)          5           1
test_fft[8] (0001_ORIGINA)     221.3749 (5.43)     427.5832 (4.63)     230.0490 (3.98)      7.9097 (2.82)     229.6250 (4.70)      7.5726 (2.43)       439;91        4.3469 (0.25)       3055           1
test_fft[9] (0001_ORIGINA)     375.0413 (9.19)     438.1672 (4.75)     395.2417 (6.84)     25.5411 (9.10)     390.6251 (7.99)     29.7506 (9.56)          1;0        2.5301 (0.15)          5           1
-
"""
